def get_transit_gateways():
    ec2_client = boto3.client('ec2')

    try:
        res = ec2_client.describe_transit_gateways()
        transit_gateways = {}

        for tgw in res.get('TransitGateways', []):
            tgw_id = tgw['TransitGatewayId']
            tgw_details = {
                'Owner': tgw['OwnerId'],
                'State': tgw['State']
            }

            attachments = ec2_client.describe_transit_gateway_attachments(
                Filters=[
                    {
                        'Name': 'transit-gateway-id',
                        'Values': [tgw_id]
                    }
                ]
            )

            attachment_data = []
            for attachment in attachments.get('TransitGatewayAttachments', []):
                routes = get_route_tables(tgw_id)  # Ensure routes are fetched for each attachment
                attachment_data.append({
                    'AttachmentId': attachment['TransitGatewayAttachmentId'],
                    'ResourceType': attachment['ResourceType'],
                    'Owner': attachment['ResourceOwnerId'],
                    'Routes': routes
                })
            tgw_details['Attachments'] = attachment_data
            transit_gateways[tgw_id] = tgw_details
        
        return transit_gateways
    
    except Exception as e:
        print(str(e))
        return None
